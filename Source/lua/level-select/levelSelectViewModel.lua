---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ninovanhooff.
--- DateTime: 29/04/2022 11:20
---

import "CoreLibs/object"
import "CoreLibs/timer"
import "../util.lua"

local keyTimer = nil
local pressed <const> = playdate.buttonIsPressed
local justPressed <const> = playdate.buttonJustPressed
local justReleased <const> = playdate.buttonJustReleased
local buttonDown <const> = playdate.kButtonDown
local buttonUp <const> = playdate.kButtonUp
local buttonA <const> = playdate.kButtonA
local buttonB <const> = playdate.kButtonB

class("LevelSelectViewModel").extends()

function LevelSelectViewModel:init()
    self.menuOptions = {}
    self.selectedChallenge = 1
    for i = 1,10 do
        self.menuOptions[i] = {
            title = "Stage " .. levelNumString(i),
            challenges = {97, 1200, 1},
            scores = {26, 2312, 3} -- fastest completion time, fuel spent, lives lost
        }
    end
    self.selectedIdx = 1
end

function LevelSelectViewModel:update()
    if justPressed(buttonDown) then
        local function timerCallback()
            if self.selectedIdx < #self.menuOptions then
                self.selectedChallenge = 0
                self.selectedIdx = self.selectedIdx + 1
            end
        end
        keyTimer = playdate.timer.keyRepeatTimer(timerCallback)
    elseif justPressed(buttonUp) then
        local function timerCallback()
            if self.selectedIdx > 1 then
                self.selectedChallenge = 0
                self.selectedIdx = self.selectedIdx - 1
            end
        end
        keyTimer = playdate.timer.keyRepeatTimer(timerCallback)
    elseif justReleased(buttonDown | buttonUp) then
        keyTimer:remove()
    end
end

function LevelSelectViewModel:selectedOption()
    return self.menuOptions[self.selectedIdx]
end
