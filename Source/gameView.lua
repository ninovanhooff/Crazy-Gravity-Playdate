---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ninovanhooff.
--- DateTime: 12/03/2022 22:55
---

import "init.lua"
import "gameHUD.lua"
import "bricksView.lua"

local gfx <const> = playdate.graphics

function RenderBackground()
    local bgTileSize = 32
    local bgOffX = math.floor(((camPos[1]*8+camPos[3]) % 128)*0.25)
    local bgOffY = math.floor(((camPos[2]*8+camPos[4]) % 128)*0.25)
    for i=0,math.ceil(screenWidth/bgTileSize) do
        for j = 0,math.ceil(hudY/bgTileSize) do
            pgeDraw(i*bgTileSize-bgOffX,j*bgTileSize-bgOffY,bgTileSize,bgTileSize,levelProps.bg*bgTileSize,60,bgTileSize,bgTileSize,0,255)
        end
    end
end

function RenderGame()
    sprite:setInverted(false)
    gfx.setColor(gfx.kColorBlack)

    RenderBackground()

    for i,item in ipairs(specialT) do -- special blocks
        scrX,scrY = (item.x-camPos[1])*8-camPos[3],(item.y-camPos[2])*8-camPos[4]
        if item.x+item.w>=camPos[1] and item.x<=camPos[1]+61 and item.y+item.h>=camPos[2] and item.y<camPos[2]+33 then
            specialRenders[item.sType-7](item)
        end
    end

    bricksView:render()

    -- plane
    pgeDraw((planePos[1]-camPos[1])*8+planePos[3]-camPos[3],(planePos[2]-camPos[2])*8+planePos[4]-camPos[4],23,23,planeRot%16*23,391+(boolToNum(planeRot>15)*2-thrust)*23,23,23)

    --explosion
    if collision and not Debug then
        pgeDraw((planePos[1]-camPos[1])*8+planePos[3]-camPos[3]+explodeX,(planePos[2]-camPos[2])*8+planePos[4]-camPos[4]+explodeY,23,23,explodeJ*23,489,23,23)
    end

    RenderHUD()

end
